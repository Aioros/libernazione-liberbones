/*! lib-bones 22-06-2016 */!function(){function a(a){var b=e("#comment_placeholder").clone().show();b.attr("id","comment-"+a.id),b.data("parent",a.parent),b.find(".comment-author .avatar").attr("src",a.author_avatar_urls[48]);var c=b.find(".comment-author .fn");""!==a.author_url?c.html(e("<a>").attr("href",a.author_url).attr("rel","external nofollow").addClass("url").text(a.author_name)):c.text(a.author_name);var d=new Date(a.date_gmt);b.find("time").attr("datetime",d.toISOString()),b.find("time a").attr("href",a.link).text(d.toLocaleString("it",{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric"}).replace(","," alle")),b.find(".comment_content").html(a.content.rendered);var f=e("<a>").attr("rel","nofollow").addClass("comment-reply-link").attr("href",a.link.substr(a.link.indexOf("#"))+"?replytocom="+a.id+"#respond").attr("onclick",'return addComment.moveForm( "comment-'+a.id+'", "'+a.id+'", "respond", "'+libComments.post_id+'" )').text("Rispondi");if(f.insertAfter(b.find(".comment_content")),libComments.ec){var g=e("<a>").addClass("comment-edit-link").attr("href","http://libernazione.it/wp-admin/comment.php?action=editcomment&c="+libComments.post_id).text("(Modifica)");g.insertAfter(f)}return b}function b(a){var b=a.data("parent");if(0===b)a.data("depth",1).addClass("depth-1").appendTo(e(".commentlist"));else{var c=e("#comment-"+b);a.data("depth",parseInt(c.data("depth"))+1).addClass("depth-"+(parseInt(c.data("depth"))+1)).appendTo(c)}}function c(d){d.fetch({data:{post:libComments.post_id,after:libComments.lastUpdate}}).done(function(c){c.forEach(function(c,d){0===e("#comment-"+c.id).length&&(comment=a(c),b(comment))})}).always(function(){libComments.lastUpdate=(new Date).toISOString(),setTimeout(function(){c(d)},15e3)})}function d(a){var b=e("<span>").addClass("comments").text(a.data("comments")?a.data("comments"):"+");a.append(b)}var e=jQuery;e("#submit").after(e("<span>").addClass("status").append(e("<img>").attr("src","/wp-includes/images/spinner.gif").css({marginLeft:"20px",display:"none"}))),wp.api.loadPromise.done(function(){var f=new wp.api.collections.Comments,g=(f.fetch({data:{post:libComments.post_id}}).done(function(g){e(".commentlist .spinner").hide();var h,i=e(".entry-content p").data("comments",0);g.forEach(function(c,d){if(""!==c.paragraph){var e=i.eq(c.paragraph);e.data("comments",e.data("comments")+1)}h=a(c),b(h),h.get().scrollIntoView()}),i.each(function(a){d(e(this)),e(this).hover(function(){clearTimeout(libComments.inlineTimeout),i.find(".comments").hide(),e(this).find(".comments").show()},function(){var a=this;libComments.inlineTimeout=setTimeout(function(){e(a).find(".comments").hide()},1e3)})}),window.location.hash&&window.location.hash.match(/#comment-\d+/)&&e(window.location.hash).get(0).scrollIntoView(),libComments.lastUpdate=(new Date).toISOString(),setTimeout(function(){c(f)},15e3)}),e("#commentform"));g.submit(function(){var c=g.serializeArray().reduce(function(a,b){return a[b.name]=b.value,a},{});e("#comment").prop("disabled",!0),e("#submit").prop("disabled",!0),e("#commentform .status img").show();var d=new wp.api.models.Comment({content:c.comment,author_name:c.author,author_email:c.email,author_url:c.url,post:c.comment_post_ID,parent:c.comment_parent});return d.save().done(function(c){var d=a(c);"approved"!=c.status&&(d.addClass("hold"),d.find(".fn").after(e("<span>").text(" (Commento in moderazione)"))),e("#cancel-comment-reply-link").click(),e("#comment").val(""),b(d)}).fail(function(a){e("#commentform .status").append(e("<span>").text("Non Ã¨ stato possibile inviare il commento"))}).always(function(){e("#comment").prop("disabled",!1),e("#submit").prop("disabled",!1),e("#commentform .status img").hide()}),!1})})}();