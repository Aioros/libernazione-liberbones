/*! lib-bones 20-06-2016 */!function(){function a(a){var b=c("#comment_placeholder").clone().show();b.attr("id","comment-"+a.id),b.data("parent",a.parent),b.find(".comment-author .avatar").attr("src",a.author_avatar_urls[48]);var d=b.find(".comment-author .fn");""!==a.author_url?d.html(c("<a>").attr("href",a.author_url).attr("rel","external nofollow").addClass("url").text(a.author_name)):d.text(a.author_name);var e=new Date(a.date_gmt);b.find("time").attr("datetime",e.toISOString()),b.find("time a").attr("href",a.link).text(e.toLocaleString("it",{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric"}).replace(","," alle")),b.find(".comment_content").html(a.content.rendered);var f=c("<a>").attr("rel","nofollow").addClass("comment-reply-link").attr("href",a.link.substr(a.link.indexOf("#"))+"?replytocom="+a.id+"#respond").attr("onclick",'return addComment.moveForm( "comment-'+a.id+'", "'+a.id+'", "respond", "'+libComments.post_id+'" )').text("Rispondi");if(f.insertAfter(b.find(".comment_content")),libComments.ec){var g=c("<a>").addClass("comment-edit-link").attr("href","http://libernazione.it/wp-admin/comment.php?action=editcomment&c="+libComments.post_id).text("(Modifica)");g.insertAfter(f)}return b}function b(a){var b=a.data("parent");if(0===b)a.data("depth",1).addClass("depth-1").appendTo(c(".commentlist"));else{var d=c("#comment-"+b);a.data("depth",parseInt(d.data("depth"))+1).addClass("depth-"+(parseInt(d.data("depth"))+1)).appendTo(d)}}var c=jQuery;c("#submit").after(c("<span>").addClass("status").append(c("<img>").attr("src","/wp-includes/images/spinner.gif").css({marginLeft:"20px",display:"none"}))),wp.api.loadPromise.done(function(){var d=new wp.api.collections.Comments,e=(d.fetch({data:{post:libComments.post_id}}).done(function(d){c(".commentlist .spinner").hide(),console.log(d);var e;d.forEach(function(c,d){e=a(c),b(e)}),window.location.hash&&c(window.location.hash).get(0).scrollIntoView()}),c("#commentform"));e.submit(function(){var d=e.serializeArray().reduce(function(a,b){return a[b.name]=b.value,a},{});c("#comment").prop("disabled",!0),c("#submit").prop("disabled",!0),c("#commentform .status img").show();var f=new wp.api.models.Comment({content:d.comment,author_name:d.author,author_email:d.email,author_url:d.url,post:d.comment_post_ID,parent:d.comment_parent});return f.save().done(function(d){console.log("Success",d),"approved"==d.status?(c("#cancel-comment-reply-link").click(),c("#comment").val(""),b(a(d))):c("#commentform .status").append(c("<span>").text("Il commento è in moderazione"))}).fail(function(a){console.log("Failed",a),c("#commentform .status").append(c("<span>").text("Non è stato possibile inviare il commento"))}).always(function(){c("#comment").prop("disabled",!1),c("#submit").prop("disabled",!1),c("#commentform .status img").hide()}),!1})})}();