/*! lib-bones 01-07-2016 */!function(){function a(a){var b=d("#comment_placeholder").clone().show();b.attr("id","comment-"+a.id),b.data("parent",a.parent),b.find(".comment-author .avatar").attr("src",a.author_avatar_urls[48]);var c=b.find(".comment-author .fn");""!==a.author_url?c.html(d("<a>").attr("href",a.author_url).attr("rel","external nofollow").addClass("url").text(a.author_name)):c.text(a.author_name);var e=new Date(a.date_gmt);b.find("time").attr("datetime",e.toISOString()),b.find("time a").attr("href",a.link).text(e.toLocaleString("it",{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric"}).replace(","," alle")),b.find(".comment_content").html(a.content.rendered);var f=d("<a>").attr("rel","nofollow").addClass("comment-reply-link").attr("href",a.link.substr(a.link.indexOf("#"))+"?replytocom="+a.id+"#respond").attr("onclick",'return addComment.moveForm( "comment-'+a.id+'", "'+a.id+'", "respond", "'+libComments.post_id+'" )').text("Rispondi");if(f.insertAfter(b.find(".comment_content")),libComments.ec){var g=d("<a>").addClass("comment-edit-link").attr("href","http://libernazione.it/wp-admin/comment.php?action=editcomment&c="+libComments.post_id).text("(Modifica)");g.insertAfter(f)}return b}function b(a){var b=a.data("parent");if(0===b)a.data("depth",1).addClass("depth-1").appendTo(d(".commentlist"));else{var c=d("#comment-"+b);a.data("depth",parseInt(c.data("depth"))+1).addClass("depth-"+(parseInt(c.data("depth"))+1)).appendTo(c)}}function c(e){e.fetch({data:{post:libComments.post_id,after:libComments.lastUpdate}}).done(function(c){console.log(c),c.forEach(function(c,e){0===d("#comment-"+c.id).length&&(comment=a(c),b(comment))})}).always(function(){libComments.lastUpdate=(new Date).toISOString(),setTimeout(function(){c(e)},15e3)})}var d=jQuery;d("#submit").after(d("<span>").addClass("status").append(d("<img>").attr("src","/wp-includes/images/spinner.gif").css({marginLeft:"20px",display:"none"}))),wp.api.loadPromise.done(function(){var e=new wp.api.collections.Comments,f=(e.fetch({data:{post:libComments.post_id}}).done(function(f){d(".commentlist .spinner").hide();var g;f.forEach(function(c,d){g=a(c),b(g)}),window.location.hash&&window.location.hash.match(/^#comment-\d+$/)&&d(window.location.hash).get(0).scrollIntoView(),libComments.lastUpdate=(new Date).toISOString(),setTimeout(function(){c(e)},15e3)}),d("#commentform"));f.submit(function(){var c=f.serializeArray().reduce(function(a,b){return a[b.name]=b.value,a},{});d("#comment").prop("disabled",!0),d("#submit").prop("disabled",!0),d("#commentform .status img").show();var e=new wp.api.models.Comment({content:c.comment,author_name:c.author,author_email:c.email,author_url:c.url,post:c.comment_post_ID,parent:c.comment_parent});return e.save().done(function(c){var e=a(c);"approved"!=c.status&&(e.addClass("hold"),e.find(".fn").after(d("<span>").text(" (Commento in moderazione)"))),d("#cancel-comment-reply-link").click(),d("#comment").val(""),b(e),e.get(0).scrollIntoView()}).fail(function(a){d("#commentform .status").append(d("<span>").text("Non Ã¨ stato possibile inviare il commento"))}).always(function(){d("#comment").prop("disabled",!1),d("#submit").prop("disabled",!1),d("#commentform .status img").hide()}),!1})})}();